### 네트워크 시작하기

- 네트워크 모든 것의 기반이 되는 OSI 7계층과 패킷이 실제 전송되는 인캡슐레이션과정 까지 알아보자!

#### 1.1 네트워크 구성도 살펴보기

- 네트워크 서비스

  - 서비스를 받는 입장 : 집에서 인터넷 접속, 회사에서 인터넷에 접속.
  - 서비스를 제공하는 입장 : 클라우드나 데이터 센터, 회사 기계실에 서버를 놓고 서비스를 제공하는 경우

- 홈 네트워크

  - 모뎀, 공유기, 단말 간의 물리적 연결로 홈 네트워크를 구성할 수 있음.
  - 무선 연결은 무선 랜 카드와 무선 신호를 보낼 수 있는 매체(공기)가 필요하고
    유선 연결은 유선 랜 카드, 랜 케이블(랜선)이 필요하다.

  - 단말기(노트북/스마트폰/데스크탑) -> 케이블/매체 -> 공유기 -> 케이블 -> 네트워크 장비(모뎀) -> 케이블 -> 인터넷

- 데이터 센터 네트워크
  - 데이터 센터 네트워크는 안정적이고 빠른 대용량 서비스 제공을 목표로 한다.
  - 안정적인 서비스를 위해 다양한 이중화 기술을 사용해야 하고 많은 서버와 서비스가 한 네트워크에 연결되어 있으므로 높은 통신량을 수용할 수 있어야 한다.
    이런 조건을 만족시키기위해 10G, 25G, 40G, 100G, 400G와 같은 고속 이더넷 기술이 사용된다.

#### 1.2 프로토콜

- 물리적 측면 : 데이터 전송 매체, 신호 규약, 회선 규격 등 이더넷이 널리 쓰인다.
- 논리적 측면 : 장치들끼리 통신하기 위한 프로토콜 규격. TCP/IP가 널리 쓰인다.

- 과거의 프로토콜은 적은 컴퓨팅 자원과 매우 느린 네트워크 속도를 이용해 최대한 효육적인 통신이 목표였다.
  즉, 문자 기반이 아닌 2진수 비트 기반으로 만들어짐. 따라서 최소한의 비트로 내용을 전송하기 위해서 서로간의 약속이 필요했다.
  (몇 번째 전기 신호는 보내는사람 주소, 몇 번째 전기 신호는 받는 사람 주소, 몇 번째 전기 신호는 상위 프로토콜 지시자 등)

- 하지만 오늘날의 애플리케이션 계층의 프로토콜은 비트말고 문자를 이용하여 헤더와 헤더값, 데이터를 표현하고 전송한다.
  <pre>
  GET / api HTTP/1.1
  Accept: text/html, application/xhtml+xml, */*
  Referer: http://zigispace.net/
  Accept-Language: ko-KR
  User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; TCO_20181006113830; rv:11.0) like Gecko
  Accept-Encoding: gzip, deflate
  Host: theplmingspace.tistory.com
  DNT: 1
  Connection: Keep-Alive
  </pre>

#### 1.3 OSI 7계층과 TCP/IP

- OSI 7계층

  | 계층              | 데이터   | 실무 용어 | 레벨  |
  | ----------------- | -------- | --------- | ----- |
  | 애플리케이션 계층 | DATA     |           | 7계층 |
  | 프레젠테이션 계층 | DATA     | 표현 계층 | 6계층 |
  | 세션 계층         | DATA     |           | 5계층 |
  | 트랜스포트 계층   | Segments | 전송 계층 | 4계층 |
  | 네트워크 계층     | Packets  |           | 3계층 |
  | 데이터 링크 계층  | Frames   |           | 2계층 |
  | 피지컬 계층       | Bits     | 물리 계층 | 1계층 |

  - 피지컬 계층 ~ 트랜스포트 계층 (1 ~ 4 계층) : 데이터 플로 계층 / 하위 계층

    - 데이터를 상대방에게 잘 전달하는 역할을 가지고 있다.
    - 네트워크 엔지니어가 고려해야 할 계층이다.

  - 세션 계층 ~ 애플리케이션 계층 (5 ~ 7 계층) : 애플리케이션 계층 / 상위 계층
    - 데이터를 잘 만드는 역할을 가지고 있음.
    - 애플리케이션 개발자들이 고려해야 할 계층이다.
      데이터를 표현하는데 초점을 맞춤.

- TCP/IP 프로토콜 스택

  - TCP/IP 계층은 총 4계층이다.
    애플리케이션 계층 -> 트랜스포트 계층 -> 인터넷 -> 네트워크 액세스

    | 계층              |
    | ----------------- |
    | 애플리케이션 계층 |
    | 애플리케이션 계층 |
    | 애플리케이션 계층 |
    | 트랜스포트 계층   |
    | 인터넷            |
    | 네트워크 액세스   |
    | 네트워크 액세스   |

#### 1.4 OSI 7계층별 이해하기

- OSI 7계층은 참조형 모델이고, 실제 사용하는 프로토콜은 TCP/IP 프로토콜 스택(4계층)이다.

- 계층별 설명

  - 1계층 (피지컬 계층)

    - 물리 계층으로 물리적 연결과 관련된 정보를 정의한다. 주로 전기 신호를 전달하는데 초점이 맞추어져 있다.
    - 주요 장비로는 허브(Hub), 리피터(Repeater), 케이블(Cable), 커넥터(Connector), 트랜시버(Trancelver), 탭(TAP)이 있다.
    - 주요 장비
      - 허브 & 리피터 : 네트워크 통신을 중재하는 네트워크 장비.
      - 케이블 & 커넥터 : 케이블 본체를 구성하는 요소이다.
      - 트랜시버 : 컴퓨터의 렌카드와 케이블을 연결하는 장비.
      - 탭 : 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비로 복제해준다.
    - 들어온 전기신호를 그대로 잘 전달하는 것이 목적이므로 전기신호가 1계층 장비에 들어오면 이 전기신호를 재생성하여 내보낸다.
      1계층 장비에는 주소라는 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 보낸다. (출발지와 목적지를 구분할 수 없다.)

  - 2계층 (데이터 링크 계층)

    - 전기 신호를 모아 우리가 알아볼 수 있는 데이터 형태로 처리한다.
      1계층과는 다르게 전기 신호를 전달하기 보다 주소 정보를 정의하고 정확한 주소로 통신이 되도록 초점이 맞추어져 있다.
      때문에, 출발지와 도착지 주소를 확인하고 내게 보낸 것이 맞는지 또는 내가 처리해야 하는지에 대해 검사한 후 데이터 처리를 수행한다.
    - 주소 체계가 생기기 때문에 여러 통신이 한꺼번에 이루어지는 것을 구분하기 위한 기능이 주로 정의된다.
      전기 신호를 모아 데이터로 처리하므로 데이터에 대한 에러를 탐지하거나 고치는 역할을 수행한다. (현재는 에러를 탐지하기만 함.)
    - 플로우 컨트롤이란?
      - 여러명과 동시에 통신 할 수 있으므로 무작정 데이터를 던지는 것이 아니라 받는 사람이 현재 이 데이터를 받을 수 있는 상태인지 체크한다.
        이것을 플로우 컨트롤 이라고 함.
    - 네트워크 인터페이스 카드란?
      - 2계층에서 동작하는 네트워크 구성 요소중 하나이다. (다른 하나는 스위치)
        2계층에서는 주소를 가진다고 하였는데 이것을 "MAC"이라고 한다. 이 네트워크 인터페이스 카드와 스위치는 모두 MAC주소를 이해할 수 있다.
      - 동작 방식
        1. 전기 신호를 데이터 형태로 만든다.
        2. 목적지 MAC 주소와 출발지 MAC주소를 확인한다.
        3. 네트워크 인터페이스 카드의 MAC주소를 확인한다.
        4. 목적지 MAC 주소와 네트워크 인터페이스 카드가 갖고 있는 MAC 주소가 맞으면 데이터를 처리하고 다르면 데이터를 폐기한다.

  - 3계층 (네트워크 계층)

    - 3계층 부터는 논리적인 IP주소가 정의된다.
      MAC주소와 달리 IP주소는 사용자가 환경에 맞게 변경하여 사용할 수 있고, 네트워크 주소 부분과 호스트 주소 부분으로 나뉜다.

  - 4계층 (트랜스포트 계층)

    - 1, 2, 3계층은 신호와 데이터를 올바른 위치로 보내고 실제 신호를 잘 만들어 보내는데 집중한다.
      하지만 4계층은 실제로 해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할을 한다.
      패킷 네트워크는 데이터를 쪼개서 패킷에 실어 보내다보니 중간에 패킷이 유실되거나 순서가 바뀌는 경우도 있다.
      이러한 문제를 해결하기 위해 패킷이 유실되거나 순서가 바뀌었을 때 패킷을 바로잡아주는 역할을 이 4계층이 한다.
    - 4계층에서 패킷을 분할 할때 패킷 헤더에 보내는 순서와 받는 순서를 적어 통신하므로 패킷이 유실되면 재전송 요청하고,
      순서가 뒤바뀌더라도 바로잡을 수 있다.
      패킷에 보내는 순서를 명시한 것이 "시퀀스 번호" 이고 받는 순서를 나타낸 것이 "ACK번호" 이다.
      그리고 장치 내의 많은 어플리케이션을 구분할 수 있도록 "포트 번호"를 사용하여 상위 어플리케이션을 구분한다.
    - 동작하는 장비
      - 로드밸런서
      - 방화벽

  - 5계층 (세션 계층) - 상위 계층

    - 양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리하고 작업 완료 후에는 이 연결을 끊는 역할을 한다.
      흔히 우리가 부르는 "세션"을 관리하는것이 주요 역할이다. TCP/IP 세션을 만들고 없애는 작업을 한다.

  - 6계층 (프레젠테이션 계층)

    - 표현 방식이 다른 어플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시키는 수행을 한다.
      일종의 번역기나 변환기 역할을 수행하는 계층.
    - MIME 인코딩이나 암호화, 압축, 코드 변환과 같은 동작이 이루어진다.

  - 7계층 (애플리케이션 계층)
    - 어플리케이션 프로세스를 정의하고 어플리케이션 서비스를 수행한다.
    - 네트워크 소프트웨어의 UI부분이나 사용자 입 출력 부분을 정의하는것이 역할이다.
    - 대표적인 프로토콜은 FTP, SMTP, HTTP, TELNET이 있다.

- 계층별 주요 프로토콜 및 장비

| 계층              | 주요 프로토콜                                     | 장비                          |
| ----------------- | ------------------------------------------------- | ----------------------------- |
| 애플리케이션 계층 | HTTP, SMP, SMTP, STUN, SFTP, TELNET               | ADC, NGFW, WAF                |
| 프레젠테이션 계층 | TLS, AFP, SSH                                     |                               |
| 세션 계층         | L2TP, PPTP, NFS, RPC, RTCP, SIP, SSH              |                               |
| 트랜스포트 계층   | TCP, UDP, SCTP, DCCP, AH, AEP                     | 로드 밸런서, 방화벽           |
| 네트워크 계층     | ARP, IPv4,IPv6, NAT, IPSec, VRRP, 라우팅 프로토콜 | 라우터, L3 스위치             |
| 데이터 링크 계층  | IEEE 802, 2, FDDI                                 | 스위치, 브릿지, 네트워크 카드 |
| 피지컬 계층       | RS-232, RS-449, V.35, S 등의 케이블               | 케이블, 허브, 탭(TAP)         |

#### 인캡슐레이션과 디캡슐레이션

- 인캡슐레이션

  - 데이터를 패킷으로 쪼개어 보내는 과정 (상위계층 -> 하위계층 전기 신호 형태의 데이터 전달)
  - 데이터를 패킷으로 쪼개어 네트워크를 이용해 목적지로 전달.
  - 인캡슐레이션 과정에서는 데이터를 보내기 전 헤더에 정보를 추가한다.
    1. 현재 계층에서 정의하는 정보
    2. 상위 프로토콜 지시자 (상위의 어떤 프로토콜을 줘야할지 결정하게 함)

- 디캡슐레이션

  - 받은 전기 신호를 데이터 형태로 만든후 그것을 받는 과정
  - 패킷으로 쪼개진 데이터를 받아 다시 큰 데이터 형태로 결합해서 사용.
