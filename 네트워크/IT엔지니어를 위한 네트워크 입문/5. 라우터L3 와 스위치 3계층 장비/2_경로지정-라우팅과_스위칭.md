### 경로지정 - 라우팅 / 스위치

- 라우터가 패킷을 처리할 때의 두가지 작업
  1. 경로 정보를 얻어 경로 정보를 정리하는 역할
  2. 정리된 경로 정보를 기반으로 패킷을 포워딩하는 역할
- 라우터는 서브넷 단위로 라우팅 정보를 습득하여 라우팅 테이블을 만들고, 패킷의 정보와 라우팅테이블의 정보가 정확히 일치하지 않더라도
  가장 목적지에 유사한 정보를 찾아 패킷을 포워딩한다.

#### 라우팅 동작과 라우팅 테이블

- 현대 네트워크는 단말 -> 목적지 까지 한번에 이동하는것이 아닌 인접 라우터(넥스트 홉)까지만 경로 지정하면
  인접 라우터(넥스트 홉)에서 최적의 경로를 다시 파악한 후 다른 라우터로 패킷을 보낸다.(홉 바이 홉 라우팅)
  즉, 라우터는 패킷이 목적지로 가는 전체 경로를 파악하는 것이 아니라 최적의 넥스트 홉을 선택해 보낸다.
- 넥스트 홉을 지정하는 방법
  1. 다음 라우터의 IP를 지정하는 방법(넥스트 홉 IP 주소)
     - 가장 일반적인 방법
  2. 라우터의 나가는 인터페이스를 지정하는 방법
     - 상대방 넥스트 홉 라우터의 IP를 몰라도 MAC주소를 알아낼 수 있을때만 사용
  3. 라우터의 나가는 인터페이스와 다음 라우터의 IP를 동시에 지정하는 방법

#### 라우팅 (라우터가 경로 정보를 얻는 방법)

- 라우터가 경로 정보를 얻는 대표적인 방법 3가지
  1. 다이렉트 커넥티드 (내가 가지고 있는 네트워크)
     - IP주소를 입력할 때 사용된 IP주소와 서브넷 마스크로 해당 IP주소가 속한 네트워크 주소 정보를 알 수 있다.
       라우터나 PC에선 이 정보로 해당 네트워크에 대해 라우팅 테이블을 자동으로 만든다. 이러한 경로 정보를 "다이렉트 커넥티드" 라고한다.
     - 경로 정보는 인터페이스에 IP를 설정하면 자동 생성되는 정보이기에 정보를 강제로 지울 수 없고 해당 네트워크 설정을 삭제하거나 인터페이스가 비활성화 되어야만 자동으로 사라진다.
  2. 스태틱 라우팅 (내가 경로를 직접 지정한 네트워크)
     - 관리자가 직접 라우터에 목적지 IP와 넥스트 홉 정보를 입력하는 것을 "스태틱 라우팅" 이라고한다.
     - 관리자가 직접 지정하므로 라우팅 정보를 매우 직관적으로 설정, 관리할 수 있다.
       하지만, 변화가 크거나 규모가 큰 네트워크일 경우 스태틱 라우팅으로 관리하기는 매우 힘들다.
     - 다이렉트 커넥티드처럼 연결된 인터페이스 정보가 삭제되거나 비활성화되면 라우팅 정보가 자동으로 삭제된다.
       하지만, 논리 인터페이스는 물리 인터페이스가 비활성화되도 함께 비활성화 되지 않는 경우도 있어 라우팅 테이블에서 사라지지 않을 경우도 있다.
  3. 다이나믹 라우팅 (경로를 전달받은 네트워크)
     - 라우터끼리 자신이 알고 있는 경로 정보나 링크 상태 정보를 교환해 전체 네트워크 정보를 학습한다.
     - 주기적으로 또는 상태정보가 변경될 때 라우터끼리 경로 정보를 교환하기 때문에 특정 경로가 장애가 생겨도 대체 경로로 패킷을 포워딩 할 수 있음.
       이처럼 관리자의 개입 없이 자동으로 라우터끼리 정보를 교환해 테이블을 갱신하고 장애발생 대처도 가능하기 때문에 대부분의 네트워크에서 다이나믹 라우팅을 사용한다.

#### 스위칭 (라우터가 경로를 지정하는 방법)

- 패킷이 들어와 라우팅 테이블을 참조하고 최적의 경로를 찾아 라우터 외부로 전송하는 작업을 "스위칭" 이라고 한다.
  이 스위칭이 일어날때, 들어온 패킷의 목적지가 라우팅 테이블에 있는 정보와 완전히 일치하는 경로가 없을때는 그 IP와 가장 가까운 경로를 찾는다.
  이 기법을 "롱기스트 프리픽스 매치" 라고 한다.

- 한번 스위칭 작업을 수행한 정보는 캐시에 저장하고 뒤에 들어오는 패킷을 라우팅 테이블에서 확인하는게 아니라 캐시를 먼저 확인한다.
  이런 캐싱 기술은 Redis와 같은 메모리 캐시를 이용해 데이터베이스 부하를 줄이는 기법과 매우 유사하다.

#### 라우팅, 스위칭 우선순위

- 라우팅 테이블은 가장 좋은 정보만 모아놓은 핵심 정보이다.

  - 이 좋은 정보의 우선순위는 경로 정보를 받는 방법과 거리를 기준으로 둔다.

- 우선순위
  1. 내가 가지고 있는 네트워크 (다이렉트 커넥티드)의 우선순위가 가장 높다.
  2. 관리자가 직접 목적지를 지정한 스태틱 라우팅이 높다. 네트워크를 관리자가 직접 입력하면 신뢰도가 높기 때문.
  3. 경로 정보를 다른 라우터를 통해 전달받기 때문에 신뢰성이 떨어짐 따라서 다이나믹 라우팅이 우선순위가 낮음.
