### DNS

- 도메인 주소를 IP 주소로 변환하는 역할을 한다.

#### DNS 구조와 명명 규칙

- 도메인은 계층 구조여서 역트리 구조로 최상위 Root부터 Top, Second, Third순으로 하위레벨로 원하는 주소를 단계적으로 찾아간다.
<pre>
  www.naver.com
  [Third-Level] . [Second-Level] . [Top-Level] (. [Root])
  -----www----- . ----naver----- . ----com---- (-생략 가능-)
  <------------------ Root 부터 거꾸로 찾아간다.
</pre>

- 각 레벨 도메인 설명
  - Root 도메인
    - 도메인을 구성하는 최상위 영역이다.
    - DNS서버에 해당 도메인의 정보가 없다면 루트 도메인을 관리하는 루트 DNS에 쿼리하게 된다.
  - TOP-Level 도메인 (TLD)
    - https://www.iana.org/domains/root/db 여기서 찾아보자

#### DNS 동작 방식

- 클라이언트 관점에서 DNS 질의 과정
  - 도메인을 IP 주소로 변환하려면 DNS서버에 도메인 쿼리하는 과정을 거쳐야한다.
    하지만 로컬에 hosts파일을 이용하면 DNS서버 없이도 도메인 리스트를 캐시에 저장할 수 있다.
  - 도메인을 쿼리하면 DNS서버에 쿼리하기전 로컬에 DNS 캐시정보를 먼저 확인한다.
    (캐시 정보에는 기존DNS 정보를 통해 확인한 동적 DNS 캐시와 hosts파일에 저장되어있는 정적DNS 캐시가 저장되어있음.)
  - 캐시정보에 도메인 정보가 없으면 DNS 서버로 쿼리를 수행하고 DNS서버로부터 응답 받으면 캐시에 먼저 저장하고 같은 쿼리로 요청하면 DNS서버에 들리지않고 캐시 정보를 이용한다.
- DNS 시스템관점에서 도메인에 대한 결괏값을 클라이언트로 보내주는 과정
  - 클라이언트에서 처음 질의를 받은 DNS가 중심이 되어 책임지고 루트 DNS부터 상위 DNS에 차근차근 쿼리를 보내 결괏값을 알아낸후 최종 결괏값만 클라이언트에 응답한다.
  - 클라이언트는 한 번의 쿼리를 보내지만 이 요청을 받은 DNS서버는 여러 단계로 쿼리를 상위 DNS서버에 보내 정보를 획득한다.

<img src="./DNS.png" />

1. 사용자는 해당 도메인이 로컬캐시정보에 있는지 확인한다.
2. 로컬 캐시 정보에 없다면 DNS서버에 쿼리한다.
3. DNS서버의 로컬캐시와 static으로 설정되어있는지 확인하고 없으면 해당 도메인을 찾기 위해 Root NS에 TLD정보를 가진 도메인 주소를 쿼리한다.
4. TLD 네임 서버 정보를 DNS서버에 응답.
5. TLD 네임 서버에 도메인에 대한 정보를 다시 쿼리
6. TLD 네임 서버는 도메인 네임 서버에 대한 정보를 DNS서버로 응답
7. DNS는 네임 서버에 해당 도메인에 대한 정보를 쿼리한다.
8. 해당 도메인에 대한 정보를 DNS에 응답한다.
9. DNS서버는 해당 도메인에 대한 정보를 로컬 캐시에 저장하고 사용자에게 응답한다.
10. 사용자는 DNS서버로부터 받은 도메인에 대한 리얼IP정보를 이용해 사이트에 접속한다.
